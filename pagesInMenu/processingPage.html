---
layout: default
title: Processing Tool
permalink: /processing-tool
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gutenberg Dialogue Extractor</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2em; }
    label, textarea, input, button { display: block; margin-top: 1em; width: 100%; max-width: 600px; }
  </style>
</head>
<body>
  <h1>Project Gutenberg Dialogue Extractor</h1>

  <label for="urlInput">Paste Project Gutenberg .txt Link:</label>
  <input type="text" id="urlInput" placeholder="https://www.gutenberg.org/cache/epub/1523/pg1523.txt" />

  <button onclick="extractAndDownload()">Generate JSON</button>

  <pre id="status"></pre>

  <script>
    async function extractAndDownload() {
      const url = document.getElementById("urlInput").value.trim();
      const status = document.getElementById("status");
      status.textContent = "Fetching text...";

      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error("Failed to fetch text");
        const text = await response.text();

        status.textContent = "Processing dialogue...";

        const lines = text.split("\n").map(line => line.trim()).filter(line => line);
        const dialogueDictionary = {};

        const elementsToDelete = ["ACT I", "Act I"];
        const blockPattern = /^[A-Z][A-Z\s\-\.]+[\.:]?$/;

        let currentSpeaker = null;
        for (let line of lines) {
          if (blockPattern.test(line)) {
            currentSpeaker = line.replace(/[\.:]$/, "").trim();
            if (!dialogueDictionary[currentSpeaker]) {
              dialogueDictionary[currentSpeaker] = [];
            }
          } else if (currentSpeaker) {
            dialogueDictionary[currentSpeaker].push(line);
          }
        }

        // Clean out unwanted "speakers"
        const keysToDelete = Object.keys(dialogueDictionary).filter(speaker =>
          elementsToDelete.some(element =>
            speaker.toLowerCase().startsWith(element.toLowerCase())
          )
        );
        for (const speaker of keysToDelete) {
          delete dialogueDictionary[speaker];
        }

        // Create and trigger JSON download
        const jsonStr = JSON.stringify(dialogueDictionary, null, 2);
        const blob = new Blob([jsonStr], { type: "application/json" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);

        // Use file name from URL or fallback
        const filename = url.split("/").pop().replace(".txt", "_dialogue.json");
        link.download = filename || "dialogue.json";
        link.click();

        status.textContent = "Done! JSON file should have downloaded.";
      } catch (error) {
        status.textContent = "Error: " + error.message;
      }
    }
  </script>
</body>
</html>